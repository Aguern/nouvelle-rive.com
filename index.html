<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mariage Marine & Nicolas</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Karla:ital,wght@1,400&display=swap');

    body {
      font-family: 'Karla', sans-serif;
      background-color: #f7f7fc;
      color: #333;
      text-align: center;
      margin: 0;
      padding: 0;
    }

    .banner {
      width: 100vw;
      max-height: 300px;
      aspect-ratio: 16 / 9;
      object-fit: cover;
      object-position: center;
      display: block;
      margin-bottom: 2rem;
    }

    h1 {
      font-size: 2rem;
      color: #333;
    }

    h2 {
      font-size: 1.2rem;
      color: #818edb;
      margin-top: 0.5rem;
    }

    p {
      margin: 1rem 0;
    }

    .btn-share-site {
      background-color: transparent;
      color: #818edb;
      border: 1px solid #818edb;
      padding: 0.8rem 1.5rem;
      border-radius: 25px;
      font-size: 0.9rem;
      cursor: pointer;
      margin: 1.5rem 0 2rem 0;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.3s ease;
    }

    .btn-share-site:hover {
      background-color: #818edb;
      color: white;
    }

    .btn-share-site svg {
      width: 16px;
      height: 16px;
    }

    .btn-fixed {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #818edb;
      color: white;
      padding: 1rem 2rem;
      border-radius: 50px;
      font-size: 1rem;
      font-weight: bold;
      border: none;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      z-index: 1000;
    }

    .btn-fixed:hover {
      background-color: #6f7ac7;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 100;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: white;
      padding: 2rem;
      border-radius: 20px;
      text-align: center;
      width: calc(90% - 2rem);
      max-width: 400px;
      margin: 1rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }

    .modal-buttons {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .modal-buttons button {
      margin: 0;
      padding: 1.2rem 2rem;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: bold;
      font-size: 1.1rem;
      transition: all 0.2s;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .public-btn {
      background-color: #818edb;
      color: white;
    }

    .public-btn:hover {
      background-color: #6f7ac7;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(129, 142, 219, 0.4);
    }

    .private-btn {
      background-color: #f0f0f0;
      color: #333;
    }

    .private-btn:hover {
      background-color: #e0e0e0;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    /* Loader */
    .loader {
      display: none;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #818edb;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 2rem auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    #gallery {
      margin-top: 3rem;
    }

    /* Galerie à marges fines et vignettes plein cadre */
    #drive-gallery {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2px;
      padding: 1rem 0;
      max-width: 900px;
      margin: auto;
    }

    #drive-gallery > div {
      position: relative;
      width: 100%;
      height: 0;
      padding-bottom: 100%;
      background: #f0f0f0;
      overflow: hidden;
    }

    #drive-gallery img,
    #drive-gallery video {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      cursor: pointer;
    }

    /* Indicateur vidéo */
    .video-indicator {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 60px;
      height: 60px;
      background: rgba(0, 0, 0, 0.7);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
    }

    .video-indicator::after {
      content: '';
      width: 0;
      height: 0;
      border-left: 20px solid white;
      border-top: 12px solid transparent;
      border-bottom: 12px solid transparent;
      margin-left: 4px;
    }

    @media (min-width: 768px) {
      #drive-gallery {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    input[type='file'] {
      display: none;
    }

    .lightbox {
      display: none;
      position: fixed;
      z-index: 200;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.9);
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .lightbox-content {
      max-width: 90%;
      max-height: 80vh;
    }

    .lightbox img,
    .lightbox video {
      max-width: 100%;
      max-height: 80vh;
      border-radius: 0;
    }

    /* Croix de fermeture */
    .lightbox .close-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      font-size: 2rem;
      color: white;
      line-height: 1;
      cursor: pointer;
      z-index: 1002;
    }

    /* Bouton téléchargement en haut à gauche */
    .download-btn {
      position: absolute;
      top: 1rem;
      left: 1rem;
      background: none;
      border: none;
      z-index: 1001;
      cursor: pointer;
    }

    .download-btn img {
      width: 28px;
      height: 28px;
      filter: invert(1);
    }

    /* Navigation dans la lightbox */
    .lightbox-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      font-size: 2.5rem;
      padding: 1rem 1.5rem;
      cursor: pointer;
      border-radius: 8px;
      transition: background-color 0.2s;
      z-index: 1001;
    }

    .lightbox-nav:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .lightbox-nav.prev {
      left: 1rem;
    }

    .lightbox-nav.next {
      right: 1rem;
    }

    body.lightbox-open .btn-fixed {
      display: none !important;
    }

    /* Styles pour le menu de sélection photo/caméra */
    .source-selection {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
      padding: 1rem;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
      z-index: 1100;
      animation: slideUp 0.3s ease-out;
    }

    @keyframes slideUp {
      from {
        transform: translateY(100%);
      }
      to {
        transform: translateY(0);
      }
    }

    .source-selection-option {
      display: flex;
      align-items: center;
      padding: 1rem;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      cursor: pointer;
      font-size: 1.1rem;
      color: #333;
      border-radius: 10px;
      transition: background-color 0.2s;
    }

    .source-selection-option:hover,
    .source-selection-option:active {
      background-color: #f0f0f0;
    }

    .source-selection-option svg {
      width: 24px;
      height: 24px;
      margin-right: 1rem;
      fill: #818edb;
    }

    .source-selection-backdrop {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1099;
    }

    .source-selection-cancel {
      margin-top: 0.5rem;
      padding: 1rem;
      width: 100%;
      border: none;
      background: #f0f0f0;
      border-radius: 10px;
      font-size: 1rem;
      cursor: pointer;
      color: #666;
    }
  </style>
</head>
<body>

  <header>
    <img src="header.png" class="banner" alt="bannière"/>
  </header>

  <h1>Mariage Marine et Nicolas</h1>
  <h2>19 juillet 2025</h2>
  <p>N'hésitez pas à nous partager vos photos ou vidéos<br />afin de nous laisser un souvenir de cette journée si spéciale.</p>
  
  <button class="btn-share-site" onclick="shareSite()">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
      <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"/>
    </svg>
    Partager ce site
  </button>

  <button class="btn-fixed" onclick="openMediaSelector()">Partager mon souvenir</button>
  
  <!-- Inputs pour différents cas -->
  <input id="mediaInput" type="file" accept="image/*,video/*" onchange="handleFile(this.files[0])" />
  <input id="cameraInput" type="file" accept="image/*,video/*" capture="environment" onchange="handleFile(this.files[0])" />
  
  <!-- Menu de sélection pour Android uniquement -->
  <div class="source-selection-backdrop" onclick="hideSourceSelection()"></div>
  <div class="source-selection" id="sourceSelection">
    <button class="source-selection-option" onclick="selectCamera()">
      <svg viewBox="0 0 24 24">
        <path d="M12 15.2c-1.8 0-3.2-1.4-3.2-3.2s1.4-3.2 3.2-3.2 3.2 1.4 3.2 3.2-1.4 3.2-3.2 3.2zm9-11.2h-3.2l-1.8-2h-8l-1.8 2h-3.2c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2v-12c0-1.1-.9-2-2-2zm-9 13c-2.8 0-5-2.2-5-5s2.2-5 5-5 5 2.2 5 5-2.2 5-5 5z"/>
      </svg>
      Caméra
    </button>
    <button class="source-selection-option" onclick="selectGallery()">
      <svg viewBox="0 0 24 24">
        <path d="M21 19v-14c0-1.1-.9-2-2-2h-14c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zm-12.5-5.5l2.5 3.01 3.5-4.51 4.5 6h-14l3.5-4.5z"/>
      </svg>
      Galerie
    </button>
    <button class="source-selection-cancel" onclick="hideSourceSelection()">Annuler</button>
  </div>

  <div id="popup" class="modal">
    <div class="modal-content">
      <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">Souhaitez-vous afficher ce média dans la galerie ?</p>
      <div class="loader" id="loader"></div>
      <div class="modal-buttons" id="modalButtons">
        <button class="public-btn" onclick="sendMedia(true)">📢 Afficher en public</button>
        <button class="private-btn" onclick="sendMedia(false)">🔒 Uniquement pour les mariés</button>
      </div>
    </div>
  </div>

  <div id="gallery">
    <h2>Galerie des invités</h2>
    <div id="drive-gallery"></div>
  </div>

  <div class="lightbox" id="lightbox" onclick="closeLightbox(event)">
    <div id="lightbox-content"></div>
    <button class="close-btn" onclick="closeLightbox({target:document.getElementById('lightbox')});">&times;</button>
    <button class="download-btn" id="downloadBtn" onclick="downloadMedia()">
      <img src="telecharger-un-fichier.png" alt="Télécharger"/>
    </button>
    <button class="lightbox-nav prev" onclick="navigateGallery(-1)">‹</button>
    <button class="lightbox-nav next" onclick="navigateGallery(1)">›</button>
  </div>

  <script>
    const folderId = "1J4fn2yvUhe0MEZY6KZtDb_2PJutP7FL7";
    const apiKey = "AIzaSyAKdgvWZ4dX7oS0btyCHtMSS-bgErTtnhY";
    let galleryFiles = [];
    let currentImageIndex = 0;
    let currentMediaFile = null;

    async function loadGallery() {
      const endpoint = `https://www.googleapis.com/drive/v3/files?q='${folderId}'+in+parents+and+(mimeType+contains+'image/'+or+mimeType+contains+'video/')&key=${apiKey}&fields=files(id,name,mimeType,thumbnailLink,webContentLink)`;
      const res = await fetch(endpoint);
      const data = await res.json();
      const container = document.getElementById("drive-gallery");

      galleryFiles = data.files;
      container.innerHTML = "";
      
      data.files.forEach((file, index) => {
        const wrapper = document.createElement("div");
        
        if (file.mimeType.includes("video")) {
          // Pour les vidéos, utiliser la thumbnail et ajouter un indicateur de lecture
          const thumb = file.thumbnailLink?.replace("=s220", "=s600") || "";
          const img = document.createElement("img");
          img.src = thumb;
          img.alt = file.name;
          img.onclick = () => openLightbox(file, index);
          
          const playIndicator = document.createElement("div");
          playIndicator.className = "video-indicator";
          
          wrapper.appendChild(img);
          wrapper.appendChild(playIndicator);
        } else {
          // Pour les images
          const thumb = file.thumbnailLink?.replace("=s220", "=s600") || "";
          const img = document.createElement("img");
          img.src = thumb;
          img.alt = file.name;
          img.onclick = () => openLightbox(file, index);
          
          wrapper.appendChild(img);
        }
        
        container.appendChild(wrapper);
      });
    }

    function openLightbox(file, index) {
      currentImageIndex = index;
      currentMediaFile = file;
      const content = document.getElementById("lightbox-content");
      const lightbox = document.getElementById("lightbox");
      const btn = document.getElementById("downloadBtn");

      content.innerHTML = "";

      if (file.mimeType.includes("video")) {
        // Pour les vidéos, utiliser une balise video native
        const video = document.createElement("video");
        video.src = `https://drive.google.com/uc?export=download&id=${file.id}`;
        video.controls = true;
        video.autoplay = true;
        video.style.maxWidth = "90vw";
        video.style.maxHeight = "80vh";
        
        // Ajouter un message de chargement
        video.addEventListener('loadstart', () => {
          const loader = document.createElement('div');
          loader.className = 'loader';
          loader.style.display = 'block';
          loader.style.position = 'absolute';
          loader.style.top = '50%';
          loader.style.left = '50%';
          loader.style.transform = 'translate(-50%, -50%)';
          content.appendChild(loader);
        });
        
        video.addEventListener('loadeddata', () => {
          const loader = content.querySelector('.loader');
          if (loader) loader.remove();
        });
        
        // Gestion d'erreur avec fallback sur iframe
        video.addEventListener('error', () => {
          console.log("Erreur de chargement vidéo, utilisation de l'iframe");
          content.innerHTML = "";
          const iframe = document.createElement("iframe");
          iframe.src = `https://drive.google.com/file/d/${file.id}/preview`;
          iframe.width = "640";
          iframe.height = "480";
          iframe.allow = "autoplay";
          iframe.style.maxWidth = "90vw";
          iframe.style.maxHeight = "80vh";
          iframe.style.border = "none";
          content.appendChild(iframe);
        });
        
        content.appendChild(video);
      } else {
        // Pour les images, utiliser l'URL directe
        const img = document.createElement("img");
        const fullSizeUrl = `https://drive.google.com/uc?export=view&id=${file.id}`;
        img.src = fullSizeUrl;
        img.alt = file.name;
        content.appendChild(img);
      }

      btn.setAttribute("data-src", file.webContentLink);
      btn.setAttribute("data-filename", file.name);
      btn.setAttribute("data-fileid", file.id);
      btn.setAttribute("data-mimetype", file.mimeType);
      document.body.classList.add("lightbox-open");
      lightbox.style.display = "flex";
      
      updateNavigationButtons();
    }

    function navigateGallery(direction) {
      currentImageIndex += direction;
      
      if (currentImageIndex < 0) currentImageIndex = galleryFiles.length - 1;
      if (currentImageIndex >= galleryFiles.length) currentImageIndex = 0;
      
      const file = galleryFiles[currentImageIndex];
      openLightbox(file, currentImageIndex);
    }

    function updateNavigationButtons() {
      const prevBtn = document.querySelector('.lightbox-nav.prev');
      const nextBtn = document.querySelector('.lightbox-nav.next');
      
      prevBtn.style.display = galleryFiles.length > 1 ? 'block' : 'none';
      nextBtn.style.display = galleryFiles.length > 1 ? 'block' : 'none';
    }

    async function downloadMedia() {
      const fileId = document.getElementById("downloadBtn").getAttribute("data-fileid");
      const fileName = document.getElementById("downloadBtn").getAttribute("data-filename");
      const mimeType = document.getElementById("downloadBtn").getAttribute("data-mimetype");
      
      try {
        // Créer un message personnalisé pour mobile
        if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
          // Créer une popup avec instructions
          const instructionModal = document.createElement('div');
          instructionModal.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 2000;
            max-width: 90%;
            text-align: center;
          `;
          
          instructionModal.innerHTML = `
            <h3 style="margin-bottom: 1rem; color: #333;">Téléchargement</h3>
            <p style="margin-bottom: 1.5rem; color: #666;">
              ${mimeType.includes('video') ? 'La vidéo' : 'La photo'} va s'ouvrir dans un nouvel onglet.<br>
              <strong>Maintenez votre doigt appuyé</strong> sur ${mimeType.includes('video') ? 'la vidéo' : "l'image"} pour la sauvegarder.
            </p>
            <button onclick="this.parentElement.remove(); window.open('https://drive.google.com/uc?export=view&id=${fileId}', '_blank');" 
                    style="background: #818edb; color: white; border: none; padding: 1rem 2rem; border-radius: 25px; font-size: 1rem; cursor: pointer;">
              Continuer
            </button>
            <button onclick="this.parentElement.remove();" 
                    style="background: #f0f0f0; color: #666; border: none; padding: 1rem 2rem; border-radius: 25px; font-size: 1rem; cursor: pointer; margin-left: 1rem;">
              Annuler
            </button>
          `;
          
          document.body.appendChild(instructionModal);
        } else {
          // Pour desktop, téléchargement classique
          const downloadUrl = `https://drive.google.com/uc?export=download&id=${fileId}`;
          const a = document.createElement("a");
          a.href = downloadUrl;
          a.download = fileName;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
        }
      } catch (error) {
        console.error("Erreur lors du téléchargement:", error);
        alert("Erreur lors du téléchargement. Veuillez réessayer.");
      }
    }

    function closeLightbox(event) {
      if (event.target.id === "lightbox" || event.key === "Escape" || event.target.classList.contains('close-btn')) {
        document.getElementById("lightbox").style.display = "none";
        document.body.classList.remove("lightbox-open");
      }
    }

    document.addEventListener("keydown", closeLightbox);
    window.addEventListener("DOMContentLoaded", loadGallery);

    // Détection de l'OS et gestion adaptative
    function isIOS() {
      return /iPhone|iPad|iPod/i.test(navigator.userAgent) || 
             (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
    }

    function openMediaSelector() {
      if (isIOS()) {
        // Sur iOS, ouvrir directement l'input qui affichera le menu natif
        document.getElementById('mediaInput').click();
      } else {
        // Sur Android et autres, afficher notre menu personnalisé
        showSourceSelection();
      }
    }

    function showSourceSelection() {
      document.getElementById('sourceSelection').style.display = 'block';
      document.querySelector('.source-selection-backdrop').style.display = 'block';
    }

    function hideSourceSelection() {
      document.getElementById('sourceSelection').style.display = 'none';
      document.querySelector('.source-selection-backdrop').style.display = 'none';
    }

    function selectCamera() {
      hideSourceSelection();
      document.getElementById('cameraInput').click();
    }

    function selectGallery() {
      hideSourceSelection();
      document.getElementById('mediaInput').click();
    }

    // Fonction de partage du site
    async function shareSite() {
      const shareData = {
        title: 'Mariage Marine & Nicolas',
        text: 'Venez partager vos souvenirs du mariage de Marine & Nicolas ! 📸💕',
        url: window.location.href
      };

      try {
        // Vérifier si l'API Web Share est supportée
        if (navigator.share) {
          await navigator.share(shareData);
        } else {
          // Fallback : copier le lien et afficher un message
          await navigator.clipboard.writeText(window.location.href);
          alert('Lien copié dans le presse-papiers !\n\nVous pouvez maintenant le partager via WhatsApp, SMS ou email.');
        }
      } catch (err) {
        // En cas d'erreur ou d'annulation, proposer la copie du lien
        if (err.name !== 'AbortError') {
          try {
            await navigator.clipboard.writeText(window.location.href);
            alert('Lien copié dans le presse-papiers !');
          } catch (clipboardErr) {
            // Fallback ultime si même le clipboard ne fonctionne pas
            prompt('Copiez ce lien pour le partager :', window.location.href);
          }
        }
      }
    }

    let selectedFile = null;
    function handleFile(file) {
      if (file) {
        selectedFile = file;
        document.getElementById('popup').style.display = 'flex';
      }
    }

    async function sendMedia(isPublic) {
      // Afficher le loader avec message de transfert
      const modalContent = document.querySelector('.modal-content');
      modalContent.innerHTML = `
        <div style="padding: 2rem;">
          <p style="font-size: 1.2rem; margin-bottom: 1.5rem;">Transfert en cours...</p>
          <div class="loader" style="display: block;"></div>
        </div>
      `;
      
      const reader = new FileReader();
      reader.onloadend = async () => {
        try {
          const base64 = reader.result.split(',')[1];
          const fd = new URLSearchParams();
          fd.append('fileContent', encodeURIComponent(base64));
          fd.append('fileType', selectedFile.type);
          fd.append('fileName', selectedFile.name);
          fd.append('public', isPublic ? 'true' : 'false');
          
          const res = await fetch(
            'https://script.google.com/macros/s/AKfycbx1tKY8CNcb1snBapGEbN0lQOkJF5-QUG299dYwWSEyTIOIuoqTcqe-22a5Q-VByQo0/exec', 
            { method: 'POST', headers: { 'Content-Type': 'application/x-www-form-urlencoded' }, body: fd }
          );
          
          const result = await res.text();
          
          // Afficher le message de succès avec style
          modalContent.innerHTML = `
            <div style="padding: 2rem;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">🎉</div>
              <h3 style="color: #4CAF50; margin-bottom: 1rem;">Merci !</h3>
              <p style="font-size: 1.1rem;">${result}</p>
            </div>
          `;
          
          // Fermer automatiquement après 3 secondes
          setTimeout(() => {
            document.getElementById('popup').style.display = 'none';
            // Réinitialiser le contenu pour la prochaine fois
            modalContent.innerHTML = `
              <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">Souhaitez-vous afficher ce média dans la galerie ?</p>
              <div class="loader" id="loader"></div>
              <div class="modal-buttons" id="modalButtons">
                <button class="public-btn" onclick="sendMedia(true)">📢 Afficher en public</button>
                <button class="private-btn" onclick="sendMedia(false)">🔒 Uniquement pour les mariés</button>
              </div>
            `;
            
            // Recharger la galerie si le média était public
            if (isPublic) {
              loadGallery();
            }
          }, 3000);
          
        } catch (error) {
          modalContent.innerHTML = `
            <div style="padding: 2
